<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Baralho</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0b3d2e">

<style>
body {
    margin: 0;
    font-family: system-ui, Arial, sans-serif;
    background: #0b3d2e;
    color: white;
    display: flex;
    justify-content: center;
    min-height: 100vh;
}
.app {
    width: 100%;
    max-width: 360px;
    padding: 16px;
    text-align: center;
}
img {
    width: 100%;
    max-width: 220px;
    border-radius: 12px;
    background: white;
    display: block;
    margin: 12px auto;
}
button {
    width: 100%;
    padding: 12px;
    margin-top: 8px;
    font-size: 1rem;
    font-weight: bold;
    border: none;
    border-radius: 8px;
    background: #f1c40f;
}
button:disabled {
    background: #aaa;
}
.carta-container {
    perspective: 1000px;
}
#cartaImg {
    transition: transform 0.6s;
}
.flip {
    transform: rotateY(180deg);
}
.miniaturas {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(48px, 1fr));
    gap: 6px;
    max-height: 120px;
    overflow-y: auto;
}
.miniaturas img {
    border-radius: 4px;
    background: white;
    cursor: pointer;
}
.descricao {
    background: rgba(0,0,0,0.25);
    padding: 10px;
    border-radius: 8px;
    font-size: 0.9rem;
    margin-top: 10px;
    text-align: left;
}
.coord {
    margin-top: 6px;
    font-weight: bold;
}
</style>
</head>

<body>
<div class="app">
    <h1>üé¥ Baralho</h1>

    <div class="carta-container">
        <img id="cartaImg"
             src="https://deckofcardsapi.com/static/img/back.png">
    </div>

    <button id="botao" onclick="sortearCarta()">Sortear carta</button>
    <button onclick="reiniciarBaralho()" style="background:#e74c3c">
        Reiniciar baralho
    </button>

    <div id="descricao" class="descricao">
        Sorteie uma carta para ver o significado.
    </div>

    <h3>Cartas sorteadas</h3>
    <div id="miniaturas" class="miniaturas"></div>
</div>

<script>
const STORAGE_KEY = "baralho-pwa";
let baralho = [];
let historico = []; // guarda carta + coordenada

const valores = ["A","2","3","4","5","6","7","8","9","0","J","Q","K"];
const naipes = ["S","H","D","C"];

/* SIGNIFICADOS */
const significadoValor = {
    A: "Uma anomalia. Algo que n√£o deveria existir ali.",
    2: "Uma passagem, como ponte, estrada ou t√∫nel.",
    3: "Uma montanha ou vulc√£o.",
    4: "Um rio ou delta.",
    5: "Um vale ou desfiladeiro.",
    6: "Uma floresta ou selva.",
    7: "Um deserto ou tundra.",
    8: "Uma praia ou litoral.",
    9: "Um lago ou mar.",
    0: "Uma plan√≠cie ou planalto.",
    J: "√Årea alagada, como p√¢ntano ou manguezal.",
    Q: "Uma pen√≠nsula ou lagoa.",
    K: "Uma ilha, arquip√©lago ou atol."
};

const significadoNaipe = {
    C: "Perto de um assentamento. Se n√£o existir, crie um.",
    S: "Longe de qualquer assentamento ou outro ponto.",
    D: "Perto de outro ponto de refer√™ncia.",
    H: "Posi√ß√£o livre e interpretativa no quadrante."
};

function rolarD6() {
    return Math.floor(Math.random() * 6) + 1;
}

function criarBaralho() {
    baralho = [];
    historico = [];
    for (let v of valores)
        for (let n of naipes)
            baralho.push(v + n);
    salvarEstado();
}

function nomeCarta(c) {
    const v = {A:"√Ås",J:"Valete",Q:"Dama",K:"Rei",0:"10"};
    const n = {S:"‚ô† Espadas",H:"‚ô• Copas",D:"‚ô¶ Ouros",C:"‚ô£ Paus"};
    return `${v[c.slice(0,-1)] || c.slice(0,-1)} de ${n[c.slice(-1)]}`;
}

function mostrarCarta(registro, animar = true) {
    const { carta, x, y } = registro;
    const valor = carta.slice(0,-1);
    const naipe = carta.slice(-1);

    document.getElementById("descricao").innerHTML =
        `<strong>${nomeCarta(carta)}</strong><br>
         <div class="coord">Coordenada: X=${x} | Y=${y}</div><br>
         <strong>O que √©:</strong><br>
         ${significadoValor[valor]}<br><br>
         <strong>Posi√ß√£o:</strong><br>
         ${significadoNaipe[naipe]}`;

    const img = document.getElementById("cartaImg");
    if (animar) {
        img.classList.add("flip");
        setTimeout(() => {
            img.src = `https://deckofcardsapi.com/static/img/${carta}.png`;
            img.classList.remove("flip");
        }, 300);
    } else {
        img.src = `https://deckofcardsapi.com/static/img/${carta}.png`;
    }
}

function adicionarMiniatura(registro) {
    const img = document.createElement("img");
    img.src = `https://deckofcardsapi.com/static/img/${registro.carta}.png`;
    img.title = `X=${registro.x} Y=${registro.y}`;
    img.onclick = () => mostrarCarta(registro, false);
    document.getElementById("miniaturas").appendChild(img);
}

function sortearCarta() {
    if (baralho.length === 0) {
        document.getElementById("botao").disabled = true;
        alert("Baralho acabou!");
        return;
    }

    const i = Math.floor(Math.random() * baralho.length);
    const carta = baralho.splice(i,1)[0];

    const registro = {
        carta,
        x: rolarD6(),
        y: rolarD6()
    };

    historico.push(registro);

    mostrarCarta(registro);
    adicionarMiniatura(registro);
    salvarEstado();
}

function salvarEstado() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify({
        baralho,
        historico
    }));
}

function carregarEstado() {
    const dados = localStorage.getItem(STORAGE_KEY);
    if (!dados) return false;

    const estado = JSON.parse(dados);
    baralho = estado.baralho || [];
    historico = estado.historico || [];

    document.getElementById("miniaturas").innerHTML = "";
    historico.forEach(r => adicionarMiniatura(r));

    if (historico.length > 0)
        mostrarCarta(historico[historico.length - 1], false);

    if (baralho.length === 0)
        document.getElementById("botao").disabled = true;

    return true;
}

function reiniciarBaralho() {
    if (!confirm("Reiniciar o baralho?")) return;

    localStorage.removeItem(STORAGE_KEY);
    criarBaralho();

    document.getElementById("miniaturas").innerHTML = "";
    document.getElementById("descricao").innerHTML =
        "Sorteie uma carta para ver o significado.";
    document.getElementById("cartaImg").src =
        "https://deckofcardsapi.com/static/img/back.png";
    document.getElementById("botao").disabled = false;
}

if (!carregarEstado()) criarBaralho();

if ("serviceWorker" in navigator)
    navigator.serviceWorker.register("service-worker.js");
</script>
</body>
</html>